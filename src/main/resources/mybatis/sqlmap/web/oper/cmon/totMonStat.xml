<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="oper.cmon.totMonStat">

	<!-- 종합관제현황_조회 -->
	<select id="searchTotMonStat" parameterType="java.util.Map" resultType="MybatisMap">
		SELECT		123456 	AS OPEN_CNT
				  , 97456 	AS OPER_CNT
				  , 24561 	AS NO_RSPS
		FROM		NOW()
	</select>

	<!-- 종합관제현황_위험감정_이력_조회 -->
	<select id="searchTotMonStatDgemHist" parameterType="java.util.Map" resultType="MybatisMap">
		SELECT      DGEM_DT,
					DGEM_TM,
					ABNM_HIST_DZON AS ABNM_HIST_DZON,
					FN_GETCDNM('PLC_CLSS_CD', ABNM_HIST_DZON) AS ABNM_HIST_DZON_NM,
					ABNM_HIST_FALL AS ABNM_HIST_FALL,
					FN_GETCDNM('ACT_DIV_CD', ABNM_HIST_FALL) AS ABNM_HIST_FALL_NM,
					ABNM_HIST_HBIT_VSLOW AS ABNM_HIST_HBIT_VSLOW,
					FN_GETCDNM('HBIT_STAT_CD', ABNM_HIST_HBIT_VSLOW) AS ABNM_HIST_HBIT_VSLOW_NM,
					ABNM_HIST_HBIT_VFAST AS ABNM_HIST_HBIT_VFAST,
					FN_GETCDNM('HBIT_STAT_CD', ABNM_HIST_HBIT_VFAST) AS ABNM_HIST_HBIT_VFAST_NM,
					ABNM_HIST_TEMP_VLOW AS ABNM_HIST_TEMP_VLOW,
					FN_GETCDNM('TEMP_STAT_CD', ABNM_HIST_TEMP_VLOW) AS ABNM_HIST_TEMP_VLOW_NM,
					ABNM_HIST_TEMP_VHIGH AS ABNM_HIST_TEMP_VHIGH,
					FN_GETCDNM('TEMP_STAT_CD', ABNM_HIST_TEMP_VHIGH) AS ABNM_HIST_TEMP_VHIGH_NM
		FROM        (
					SELECT      TO_CHAR(TO_DATE(DGEM_DT, 'YYYYMMDD'::TEXT), 'MM/DD') AS DGEM_DT,
								TO_CHAR(TO_TIMESTAMP(DGEM_TM, 'HH24MISS'::TEXT), 'AM HH12:MI') AS DGEM_TM,
								CASE WHEN PLC_CLSS_CD   = 'DZONE'   THEN 'DZONE'    END AS ABNM_HIST_DZON,
								CASE WHEN ACT_DIV_CD    = 'FALL'    THEN 'FALL'     END AS ABNM_HIST_FALL,
								CASE WHEN HBIT_STAT_CD  = 'VSLOW'   THEN 'VSLOW'    END AS ABNM_HIST_HBIT_VSLOW,
								CASE WHEN HBIT_STAT_CD  = 'VFAST'   THEN 'VFAST'    END AS ABNM_HIST_HBIT_VFAST,
								CASE WHEN TEMP_STAT_CD  = 'VLOW'    THEN 'VLOW'     END AS ABNM_HIST_TEMP_VLOW,
								CASE WHEN TEMP_STAT_CD  = 'VHIGH'   THEN 'VHIGH'    END AS ABNM_HIST_TEMP_VHIGH
					FROM        TS_STDT_DGEM_HIST TSDH
					WHERE       1=1
				  	AND         TSDH.DGEM_DT BETWEEN TO_CHAR(NOW() - INTERVAL '1 MONTH' , 'YYYYMMDD'::TEXT) AND TO_CHAR(NOW(), 'YYYYMMDD'::TEXT)
					ORDER BY    TSDH.DGEM_DT DESC, TSDH.DGEM_TM DESC
					LIMIT       11
					) ABNM_HIST
	</select>

	<!-- 종합관제현황_위험감정_이력_조회_임시 -->
	<select id="searchTotMonStatDgemHistTemp" parameterType="java.util.Map" resultType="MybatisMap">
		SELECT		TO_CHAR(TO_DATE(DGEM_DT, 'YYYYMMDD'::TEXT), 'MM/DD') AS DGEM_DT,
					  TO_CHAR(TO_TIMESTAMP(DGEM_TM, 'HH24MISS'::TEXT), 'AM HH12:MI') AS DGEM_TM,
					  DGEM_STAT_CD,
					  FN_GETCDNM('DGEM_STAT_CD', DGEM_STAT_CD) AS DGEM_STAT_NM
		FROM		TS_STDT_DGEM_HIST TSDH
		WHERE		1 = 1
		ORDER BY	DGEM_DT DESC, DGEM_TM DESC
			LIMIT 		11
	</select>

	<!-- 종합관제현황_메뉴_리스트_조회 -->
	<select id="searchTotMonStatMenuList" parameterType="java.util.Map" resultType="MybatisMap">
		SELECT 	A.MENU_NO,
			 	A.MENU_NM,
			 	A.MENU_URL
		FROM   	TC_MENU_BASE A
			   	INNER JOIN TC_MENU_ROLE C
				ON  C.MENU_NO = A.MENU_NO
			   	INNER JOIN TC_USER_ROLE D
			  	ON  D.ROLE_CD = C.ROLE_CD
		WHERE  	1 = 1
		AND    	A.USE_YN  = 'Y'
		AND    	D.USER_ID = #{userId}
		AND    	A.MENU_URL IS NOT NULL
		ORDER BY A.MENU_NO
	</select>

</mapper>